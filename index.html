<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Qu·∫£n l√Ω - ƒêi·ªán M√°y Xanh Savico</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --dmx-blue: #0088ff;
            --dmx-green: #28a745;
            --dmx-orange: #fd7e14;
            --bg-color: #f0f2f5;
            --border-color: #dee2e6;
            --text-dark: #333;
            --text-light: #fff;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --purple-color: #6f42c1;
        }

        /* --- C√†i ƒë·∫∑t t·ªïng th·ªÉ --- */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-dark);
            display: flex;
            flex-direction: column;
        }

        /* --- Header c·ªßa trang ch·ªß --- */
        .main-header {
            background: linear-gradient(90deg, var(--dmx-blue) 0%, var(--dmx-green) 100%);
            color: var(--text-light);
            padding: 10px 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            position: relative;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .main-header .store-icon {
            width: 40px;
            height: 40px;
            fill: var(--text-light);
        }

        .main-header h1 {
            margin: 0;
            font-size: 1.6em;
            font-weight: 600;
        }

        /* --- N√∫t Backup T·ªïng --- */
        .backup-btn {
            background-color: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            margin-right: 15px;
        }
        .backup-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        /* --- CSS CHO PH·∫¶N M√É QR --- */
        .qr-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.15);
            padding: 5px 10px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.3);
            cursor: pointer;
            transition: background-color 0.3s ease;
            position: relative;
            z-index: 101;
            min-width: 180px; 
        }
        
        .qr-container:hover {
            background-color: rgba(255, 255, 255, 0.25);
        }

        .qr-img {
            width: 60px; 
            height: 60px;
            object-fit: contain;
            border-radius: 4px;
            background-color: #fff;
            display: block;
        }

        .qr-text {
            font-size: 11px; 
            margin-top: 4px;
            font-weight: 500;
            color: #fff;
            text-transform: none; 
            letter-spacing: 0.5px;
            text-align: center;
        }

        /* Overlay QR */
        .qr-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.3s ease;
            cursor: pointer;
        }

        .qr-overlay.active {
            display: flex;
            opacity: 1;
        }

        .qr-overlay-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
            animation: fadeInScale 0.3s ease-out forwards;
            position: relative;
        }

        .qr-overlay-img {
            width: 250px;
            height: 250px;
            object-fit: contain;
            display: block;
            margin: 0 auto 15px auto;
            border: 1px solid #eee;
            border-radius: 4px;
        }
        
        .qr-overlay-close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 2em;
            color: #555;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .qr-overlay-close:hover {
            color: #000;
        }

        /* --- Backup Modal Styles --- */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 2000; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.5); 
            backdrop-filter: blur(2px);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 2% auto; 
            padding: 25px;
            border: 1px solid #888;
            width: 90%; 
            max-width: 700px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            max-height: 90vh;
            overflow-y: auto;
        }

        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-modal:hover { color: #000; }

        .backup-section-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #444;
            margin-bottom: 10px;
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-actions-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px dashed #ccc;
        }

        .backup-textarea {
            width: 100%;
            height: 120px;
            margin: 10px 0;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
            resize: vertical;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }

        .btn-copy { background-color: #6c757d; color: white; }
        .btn-restore { background-color: var(--dmx-green); color: white; }
        .btn-clear { background-color: var(--danger-color); color: white; margin-right: auto; }
        .btn-download { background-color: var(--dmx-blue); color: white; width: 50%; justify-content: center;}
        .btn-upload { background-color: var(--dmx-orange); color: white; width: 50%; justify-content: center;}
        
        .action-btn:hover { opacity: 0.9; transform: translateY(-1px); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        /* --- Thanh Tabs ƒëi·ªÅu h∆∞·ªõng --- */
        .tab-bar {
            background-color: var(--bg-color); 
            padding: 15px 20px; 
            border-bottom: none; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
            display: flex;
            gap: 15px; 
            flex-wrap: wrap;
            z-index: 99;
            position: sticky; 
            top: 0;
        }

        .tab-button {
            padding: 10px 22px; 
            cursor: pointer;
            border: none;
            background-color: #fff; 
            font-size: 0.95em;
            font-weight: 600;
            color: #555;
            border-radius: 25px; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 
                3px 3px 6px rgba(189, 194, 201, 0.7), 
                -3px -3px 6px rgba(255, 255, 255, 1); 
        }

        .tab-button:hover { 
            color: var(--dmx-blue); 
            transform: translateY(-2px); 
            box-shadow: 
                5px 5px 10px rgba(189, 194, 201, 0.8), 
                -5px -5px 10px rgba(255, 255, 255, 1.2);
        }

        .tab-button.active { 
            color: var(--text-light); 
            background: linear-gradient(45deg, var(--dmx-blue), #0066cc);
            transform: translateY(0); 
            box-shadow: 
                inset 2px 2px 5px rgba(0, 0, 0, 0.2), 
                inset -2px -2px 5px rgba(255, 255, 255, 0.1),
                0 1px 3px rgba(0, 0, 0, 0.2); 
        }

        /* --- V√πng ch·ª©a n·ªôi dung --- */
        .content-area {
            flex-grow: 1;
            overflow: hidden;
            position: relative;
            z-index: 1;
            background: #fff;
        }

        .tab-content {
            display: none;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        .tab-content.active { display: block; }
        .content-iframe { width: 100%; height: 100%; border: none; }
        
        /* Toast Notification */
        .toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 4px;
            padding: 16px;
            position: fixed;
            z-index: 3000;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            font-size: 16px;
        }
        .toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }

        @media (max-width: 900px) {
            .main-header { flex-direction: column; align-items: stretch; gap: 10px; padding: 10px;}
            .header-left { justify-content: space-between; }
            .header-actions { flex-direction: column; align-items: stretch; }
            .backup-btn { margin-right: 0; justify-content: center; }
            .tab-bar { padding: 10px; overflow-x: auto; flex-wrap: nowrap; }
            .tab-button { padding: 8px 15px; white-space: nowrap; font-size: 0.9em; }
            .file-actions-container { flex-direction: column; }
            .btn-download, .btn-upload { width: 100%; }
        }
    </style>
</head>
<body>

    <header class="main-header">
        <div class="header-left">
            <svg class="store-icon" viewBox="0 0 24 24">
                <path d="M12,3L2,12V21H22V12L12,3M19,19H17V12H7V19H5V10.19L12,5.69L19,10.19V19M12,14A2,2 0 0,1 14,16A2,2 0 0,1 12,18A2,2 0 0,1 10,16A2,2 0 0,1 12,14Z" />
            </svg>
            <h1>üèÜDashboard Qu·∫£n l√Ω - NH.D∆∞∆°ng 32859üèÜ</h1>
        </div>
        
        <div class="header-actions" style="display: flex; align-items: center; gap: 5px;">
            <button class="backup-btn" onclick="openBackupModal()">
                <i class="fas fa-database"></i> Backup/Restore T·ªïng
            </button>

            <div class="qr-container" id="qrContainer">
                <img src="qr.png" alt="QR VietinBank" class="qr-img">
                <span class="qr-text">üíóTh·∫•y hay th√¨ m·ªùi D∆∞∆°ng c·ªëc C√† Ph√™!‚òï</span>
            </div>
        </div>
    </header>

    <div class="tab-bar">
        <button class="tab-button active" onclick="openTab(event, 'Rtst')">üìä Realtime</button>
        <button class="tab-button" onclick="openTab(event, 'Lkst')">üßë‚Äçüíª BI L≈©y K·∫ø</button>
        <button class="tab-button" onclick="openTab(event, 'biNhanVien')">üßë‚Äçüíª BI Nh√¢n vi√™n</button>
		<button class="tab-button" onclick="openTab(event, 'biNhanVien2')">üßë‚Äçüíª BI Nh√¢n vi√™n (new)</button>
        <button class="tab-button" onclick="openTab(event, 'baoCaoYCX')">üìà B√°o c√°o YCX</button>
        <button class="tab-button" onclick="openTab(event, 'tonlap')">üì¶ T·ªìn Laptop</button>
        <button class="tab-button" onclick="openTab(event, 'popuploc')">üñ®Ô∏è In popup</button>    
        <button class="tab-button" onclick="openTab(event, 'banhang')">‚úçÔ∏è Nh·∫≠t k√Ω BH</button>  
    </div>

    <main class="content-area">
        <div id="Rtst" class="tab-content active">
            <iframe id="iframe-rt" class="content-iframe" src="./RT.html"></iframe>
        </div>
        <div id="Lkst" class="tab-content">
            <iframe id="iframe-lk" class="content-iframe" src="./Lkst.html"></iframe>
        </div>
        <div id="biNhanVien" class="tab-content">
            <iframe id="iframe-nv" class="content-iframe" src="./NV.html"></iframe>
        </div>
		<div id="biNhanVien2" class="tab-content">
            <iframe class="content-iframe" src="./NV2.html"></iframe>
        </div>
        <div id="baoCaoYCX" class="tab-content">
            <iframe class="content-iframe" src="./YCX.html"></iframe>
        </div>
        <div id="tonlap" class="tab-content">
            <iframe class="content-iframe" src="./tonlap.html"></iframe>
        </div>
        <div id="popuploc" class="tab-content">
            <iframe class="content-iframe" src="./popuploc.html"></iframe>
        </div>    
        <div id="banhang" class="tab-content">
            <iframe class="content-iframe" src="./banhang.html"></iframe>
        </div>  
    </main>

    <div class="qr-overlay" id="qrOverlay">
        <div class="qr-overlay-content">
            <span class="qr-overlay-close" onclick="hideQrOverlay()">&times;</span>
            <img src="qr.png" alt="QR VietinBank" class="qr-overlay-img">
            <span class="qr-overlay-text">üíóTh·∫•y hay th√¨ m·ªùi D∆∞∆°ng c·ªëc C√† Ph√™!‚òï</span>
        </div>
    </div>

    <!-- UPDATE: Backup Modal m·ªõi -->
    <div id="backupModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeBackupModal()">&times;</span>
            <h2 style="margin-top:0; color: var(--dmx-blue);"><i class="fas fa-database"></i> Qu·∫£n l√Ω D·ªØ li·ªáu H·ªá th·ªëng</h2>
            
            <p style="font-size: 0.9em; color: #666; margin-bottom: 20px;">
                Qu·∫£n l√Ω d·ªØ li·ªáu to√†n b·ªô trang Dashboard (bao g·ªìm Realtime, Nh√¢n vi√™n, v.v.).
            </p>

            <!-- C√ÅCH 1: FILE (NEW) -->
            <div class="backup-section-title"><i class="fas fa-file-alt"></i> C√°ch 1: D√πng File (Nhanh & Ti·ªán)</div>
            <div class="file-actions-container">
                <button class="action-btn btn-download" onclick="downloadBackupFile()">
                    <i class="fas fa-download"></i> T·∫£i File Backup (.json)
                </button>
                
                <input type="file" id="backupFileInput" accept=".json, .txt" style="display: none;" onchange="handleFileSelect(this)">
                <button class="action-btn btn-upload" onclick="document.getElementById('backupFileInput').click()">
                    <i class="fas fa-upload"></i> Kh√¥i ph·ª•c t·ª´ File
                </button>
            </div>

            <!-- C√ÅCH 2: TEXT -->
            <div class="backup-section-title"><i class="fas fa-code"></i> C√°ch 2: Th·ªß c√¥ng (Copy/Paste m√£)</div>
            <textarea id="globalDataTextarea" class="backup-textarea" placeholder="Chu·ªói d·ªØ li·ªáu JSON..."></textarea>
            
            <div class="modal-actions">
                <button class="action-btn btn-clear" onclick="clearAllData()">üóëÔ∏è X√≥a s·∫°ch d·ªØ li·ªáu</button>
                <button class="action-btn btn-copy" onclick="copyGlobalData()">üìã Copy m√£</button>
                <button class="action-btn btn-restore" onclick="restoreGlobalData()">üì• Kh√¥i ph·ª•c t·ª´ m√£</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast">Th√¥ng b√°o</div>

    <script>
        // --- Tab Logic ---
        function openTab(evt, tabName) {
            let i, tabContents, tabButtons;
            tabContents = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove("active");
            }
            tabButtons = document.getElementsByClassName("tab-button");
            for (i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove("active");
            }
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }

        // --- QR Logic ---
        const qrContainer = document.getElementById('qrContainer');
        const qrOverlay = document.getElementById('qrOverlay');

        // S·ª¨A: B·ªè 'mouseenter' thay b·∫±ng 'click'
        qrContainer.addEventListener('click', () => {
            qrOverlay.classList.add('active');
        });

        function hideQrOverlay() {
            qrOverlay.classList.remove('active');
        }

        qrOverlay.addEventListener('click', (event) => {
            if (event.target === qrOverlay) hideQrOverlay();
        });

        // --- BACKUP / RESTORE GLOBAL LOGIC ---
        
        // 1. Helper: L·∫•y to√†n b·ªô d·ªØ li·ªáu
        function getAllLocalStorage() {
            const allData = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                allData[key] = localStorage.getItem(key);
            }
            return allData;
        }

        // 2. M·ªü Modal & hi·ªÉn th·ªã text
        function openBackupModal() {
            const modal = document.getElementById('backupModal');
            const textarea = document.getElementById('globalDataTextarea');
            
            const allData = getAllLocalStorage();
            textarea.value = JSON.stringify(allData, null, 2);
            modal.style.display = "block";
        }

        function closeBackupModal() {
            document.getElementById('backupModal').style.display = "none";
        }

        // 3. T·∫£i File Backup (NEW)
        function downloadBackupFile() {
            const allData = getAllLocalStorage();
            const dataStr = JSON.stringify(allData, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            
            // T·∫°o t√™n file c√≥ ng√†y th√°ng
            const date = new Date();
            const dateStr = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
            const fileName = `Backup_Dashboard_DMX_${dateStr}.json`;

            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast("ƒêang t·∫£i file backup xu·ªëng...");
        }

        // 4. X·ª≠ l√Ω khi ch·ªçn File ƒë·ªÉ kh√¥i ph·ª•c (NEW)
        function handleFileSelect(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                processRestore(content);
                // Reset input ƒë·ªÉ c√≥ th·ªÉ ch·ªçn l·∫°i file ƒë√≥ l·∫ßn n·ªØa n·∫øu mu·ªën
                input.value = '';
            };
            reader.readAsText(file);
        }

        // 5. H√†m x·ª≠ l√Ω logic kh√¥i ph·ª•c chung (D√πng cho c·∫£ File v√† Textarea)
        function processRestore(jsonStr) {
            if (!jsonStr || jsonStr.trim() === "") {
                showToast("D·ªØ li·ªáu r·ªóng!");
                return;
            }

            try {
                const data = JSON.parse(jsonStr);
                
                if (typeof data !== 'object' || data === null) {
                    throw new Error("D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá.");
                }

                if (confirm("C·∫¢NH B√ÅO QUAN TR·ªåNG:\n\nH√†nh ƒë·ªông n√†y s·∫Ω X√ìA TO√ÄN B·ªò d·ªØ li·ªáu hi·ªán t·∫°i v√† thay th·∫ø b·∫±ng d·ªØ li·ªáu t·ª´ b·∫£n backup.\n\nB·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ti·∫øp t·ª•c kh√¥ng?")) {
                    // X√≥a d·ªØ li·ªáu c≈©
                    localStorage.clear();
                    
                    // N·∫°p d·ªØ li·ªáu m·ªõi
                    for (const key in data) {
                        localStorage.setItem(key, data[key]);
                    }

                    showToast("Kh√¥i ph·ª•c th√†nh c√¥ng! ƒêang t·∫£i l·∫°i trang...");
                    setTimeout(() => {
                        location.reload(); 
                    }, 1500);
                }
            } catch (e) {
                console.error(e);
                showToast("L·ªói: File ho·∫∑c M√£ kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng JSON.");
            }
        }

        // 6. C√°c h√†m c≈© (Copy, Restore t·ª´ Textarea)
        function copyGlobalData() {
            const textarea = document.getElementById('globalDataTextarea');
            textarea.select();
            textarea.setSelectionRange(0, 99999);
            document.execCommand('copy');
            showToast("ƒê√£ sao ch√©p m√£ d·ªØ li·ªáu!");
        }

        function restoreGlobalData() {
            const textarea = document.getElementById('globalDataTextarea');
            processRestore(textarea.value);
        }

        function clearAllData() {
            if (confirm("C·∫¢NH B√ÅO C·ª∞C M·∫†NH: B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën X√ìA S·∫†CH to√†n b·ªô d·ªØ li·ªáu kh√¥ng? M·∫•t h·∫øt ƒë√≥ nha!")) {
                localStorage.clear();
                document.getElementById('globalDataTextarea').value = "{}";
                showToast("ƒê√£ x√≥a s·∫°ch d·ªØ li·ªáu h·ªá th·ªëng.");
                setTimeout(() => location.reload(), 1500);
            }
        }

        // Toast Notification Function
        function showToast(message) {
            const x = document.getElementById("toast");
            x.textContent = message;
            x.className = "toast show";
            setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('backupModal');
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    </script>

</body>
</html>